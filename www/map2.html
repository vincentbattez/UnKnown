<!DOCTYPE html>
<html>
<head>
<title>Route Finder Demo</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADHx9yCM6kfEHl8Z9hybcIQiPPhVl1Zrc"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<style>
#mapDiv 
{
    width:100%;
    height:400px;
    border:thin solid #CCC;
}

#controlPanel
{
    position: absolute;
    top: 50px;
    left: 10px;
    z-index: 2;
    background-color: #fff;
    padding: 5px;
    border: 1px solid #999;
}

#directions
{
    float:left;
    width:100%;
    margin:0px;
}
</style>

<script>
var currentLocationMap;
var directionsDisplay;
var directionsService;


var latStart, lngStart;
var start;	

navigator.geolocation.getCurrentPosition(function(location) {
	latStart = location.coords.latitude; 
	lngStart = location.coords.longitude;
	var start = new google.maps.LatLng(parseFloat(latStart),parseFloat(lngStart));
});

console.log(latStart);


function StartMap()
{
    directionsService = new google.maps.DirectionsService();
    // route planner
    directionsDisplay = new google.maps.DirectionsRenderer();
    currentLocationMap = new google.maps.LatLng(latStart, lngStart);  // DkIT

    var mapOptions = {zoom: 15, center: currentLocationMap};
    currentLocationMap = new google.maps.Map(document.getElementById('mapDiv'), mapOptions);
    directionsDisplay.setMap(currentLocationMap);		
	
	
		
	//toBeFound();
	Finder();
	
	//calculateRoute();
}
	
	
	function toBeFound()
{
	var lodz = new google.maps.LatLng(latStart, lngStart);
	var myCity = new google.maps.Circle({
    center: lodz,
    radius: 500,
    strokeColor: "#0000FF",
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: "#0000FF",
    fillOpacity: 0.4
  });
  myCity.setMap(currentLocationMap);
}	



function Finder()
{
 //   var start = document.getElementById('start').value;
	
	var Street;
	
	var html = "<b>End: </b> <input type='text' id='end' required>";

	if(!$('#end').length){
		$('#controlPanel').append(html);	
	}
	
	$.ajax({ url:'http://maps.googleapis.com/maps/api/geocode/json?latlng='+latStart+','+lngStart+'&sensor=true',
			 success: function(data){
				 //alert(data.results[0].formatted_address);
				 street = data.results[0].formatted_address;
			 }
	});
	
		// End get json parse from php
			
	    var end = document.getElementById('end').value;

    var request = {origin: street,
        destination: end,
        travelMode: google.maps.TravelMode.DRIVING};


    directionsService.route(request, function (response, status)
    {
        if (status == google.maps.DirectionsStatus.OK)
        {
            directionsDisplay.setDirections(response);
        }
    });

}

</script>
</head>

<body onload='init()'>
<div id="controlPanel">
<!--
<select id="end">
<option value="Dundalk Institute of Technology Louth Ireland">DkIT</option>
<option value="Narutowicza 2, 95-050 Konstantynów Łódzki, Polska">DCU</option>
<option value="Maynooth University Ireland">Maynooth</option>
</select>
-->
   
<button onclick='StartMap()'>Start</button>

</div>

<div id="mapDiv"></div>           

</body>
</html>